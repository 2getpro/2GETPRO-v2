# üìò –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é 2GETPRO v2 –Ω–∞ Ubuntu 24.04 LTS

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Telegram-–±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ VPN-–ø–æ–¥–ø–∏—Å–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker Compose –Ω–∞ Ubuntu 24.04 LTS.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#1-–≤–≤–µ–¥–µ–Ω–∏–µ-–∏-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π](#2-–¥–µ—Ç–∞–ª—å–Ω—ã–π-—Ä–∞–∑–±–æ—Ä-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è](#3-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
4. [–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Docker Compose](#4-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π-docker-compose)
5. [–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é](#5-–ø–æ—à–∞–≥–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–ø–æ-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é)
6. [–ß–µ–∫-–ª–∏—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏](#6-—á–µ–∫-–ª–∏—Å—Ç-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)
7. [Troubleshooting](#7-troubleshooting)
8. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞](#8-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ø–æ–¥–¥–µ—Ä–∂–∫–∞)

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1.1 –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**2GETPRO v2** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–∞–∂–∏ VPN-–ø–æ–¥–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ Telegram —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ –ø–∞–Ω–µ–ª–µ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **Telegram Bot** - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Python 3.11+
- **PostgreSQL 15** - —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–¥–ø–∏—Å–æ–∫, –ø–ª–∞—Ç–µ–∂–µ–π
- **Redis 7** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –∏ –¥–∞—à–±–æ—Ä–¥—ã
- **Nginx** - reverse proxy –¥–ª—è webhook'–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1.2 –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

```mermaid
graph TB
    subgraph "–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã"
        TG[Telegram API]
        YK[YooKassa]
        CP[CryptoPay]
        FK[FreeKassa]
        Panel[VPN Panel API]
    end
    
    subgraph "Docker Compose Stack"
        Nginx[Nginx :80,:443]
        Bot1[Bot Instance 1 :8080]
        Bot2[Bot Instance 2 :8080]
        Bot3[Bot Instance 3 :8080]
        PG[(PostgreSQL :5432)]
        RD[(Redis :6379)]
        Prom[Prometheus :9090]
        Graf[Grafana :3000]
    end
    
    subgraph "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
        PGE[PostgreSQL Exporter]
        RDE[Redis Exporter]
        NGE[Nginx Exporter]
    end
    
    TG <-->|Polling/Webhook| Nginx
    Nginx -->|Load Balance| Bot1
    Nginx -->|Load Balance| Bot2
    Nginx -->|Load Balance| Bot3
    
    Bot1 <-->|SQL| PG
    Bot2 <-->|SQL| PG
    Bot3 <-->|SQL| PG
    
    Bot1 <-->|Cache| RD
    Bot2 <-->|Cache| RD
    Bot3 <-->|Cache| RD
    
    Bot1 <-->|Payments| YK
    Bot1 <-->|Payments| CP
    Bot1 <-->|Payments| FK
    Bot1 <-->|API| Panel
    
    Bot1 -->|Metrics| Prom
    Bot2 -->|Metrics| Prom
    Bot3 -->|Metrics| Prom
    PGE -->|Metrics| Prom
    RDE -->|Metrics| Prom
    NGE -->|Metrics| Prom
    
    Graf -->|Query| Prom
    
    style Bot1 fill:#4CAF50
    style Bot2 fill:#4CAF50
    style Bot3 fill:#4CAF50
    style PG fill:#336791
    style RD fill:#DC382D
    style Prom fill:#E6522C
    style Graf fill:#F46800
```

### 1.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```mermaid
sequenceDiagram
    participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant TG as Telegram
    participant Bot as Bot Service
    participant Redis as Redis Cache
    participant DB as PostgreSQL
    participant Payment as Payment Provider
    participant Panel as VPN Panel
    
    User->>TG: /start
    TG->>Bot: Update
    Bot->>Redis: Check cache
    Redis-->>Bot: Cache miss
    Bot->>DB: Get/Create User
    DB-->>Bot: User data
    Bot->>Redis: Cache user
    Bot->>TG: Welcome message
    
    User->>TG: Buy subscription
    TG->>Bot: Callback
    Bot->>Payment: Create payment
    Payment-->>Bot: Payment URL
    Bot->>TG: Payment link
    
    User->>Payment: Pay
    Payment->>Bot: Webhook notification
    Bot->>DB: Create payment record
    Bot->>Panel: Create/Extend subscription
    Panel-->>Bot: Subscription data
    Bot->>DB: Update subscription
    Bot->>TG: Success notification
```

### 1.4 –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

#### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–û–°**: Ubuntu 24.04 LTS
- **CPU**: 2 —è–¥—Ä–∞ (vCPU)
- **RAM**: 4 GB
- **–î–∏—Å–∫**: 40 GB SSD
- **–°–µ—Ç—å**: 100 –ú–±–∏—Ç/—Å

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **CPU**: 4 —è–¥—Ä–∞ (vCPU)
- **RAM**: 8 GB
- **–î–∏—Å–∫**: 80 GB NVMe SSD
- **–°–µ—Ç—å**: 1 –ì–±–∏—Ç/—Å
- **–†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–∞–Ω–∞–ª** (–¥–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏)

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ç–∏:
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã: 80 (HTTP), 443 (HTTPS)
- –î–æ—Å—Ç—É–ø –∫ Telegram API (149.154.160.0/20, 91.108.4.0/22)
- –ë–µ–ª—ã–π IP-–∞–¥—Ä–µ—Å (–¥–ª—è webhook'–æ–≤)

---

## 2. –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 2.1 Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ê–Ω–∞–ª–∏–∑ [`requirements.txt`](requirements.txt):

#### Core Bot Framework
```txt
aiogram>=3.0.0          # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram Bot API
aiohttp>=3.9.0          # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Å–Ω–æ–≤–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.

#### Database
```txt
sqlalchemy>=2.0.0       # ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
alembic>=1.12.0         # –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
asyncpg>=0.29.0         # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–∞–±–æ—Ç–∞ —Å PostgreSQL, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π –ë–î.

#### Configuration & Validation
```txt
pydantic>=2.5.0            # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
pydantic-settings>=2.1.0   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
python-dotenv>=1.0.0       # –ó–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–æ–≤
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

#### Monitoring & Observability
```txt
prometheus-client>=0.19.0     # –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
sentry-sdk>=1.39.0            # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
python-json-logger>=2.0.7     # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫.

#### Caching
```txt
redis>=5.0.0            # –ö–ª–∏–µ–Ω—Ç Redis
aioredis>=2.0.1         # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Redis
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π.

#### Security
```txt
cryptography>=41.0.0    # –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
python-jose>=3.3.0      # JWT —Ç–æ–∫–µ–Ω—ã
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –≤–∞–ª–∏–¥–∞—Ü–∏—è webhook'–æ–≤.

#### Payment Systems
```txt
aiocryptopay>=0.4.0,<0.5.0   # CryptoPay API
yookassa>=2.3.0              # YooKassa API
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏.

#### Utilities
```txt
python-dateutil>=2.8.2   # –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏
pytz>=2023.3             # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã
loguru>=0.7.0            # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### 2.2 –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### Ubuntu 24.04 LTS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
```bash
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ —Å–±–æ—Ä–∫–∞
build-essential          # gcc, g++, make
gcc                      # GNU C –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä
python3-dev              # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã Python

# –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏
libssl-dev              # OpenSSL –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
libffi-dev              # Foreign Function Interface
libpq-dev               # PostgreSQL –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

# –£—Ç–∏–ª–∏—Ç—ã
curl                    # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
wget                    # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
git                     # –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π
```

### 2.3 Docker –∏ Docker Compose

#### Docker Engine
- **–í–µ—Ä—Å–∏—è**: 24.0+
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: Docker Engine, containerd, Docker CLI
- **–ü–ª–∞–≥–∏–Ω—ã**: docker-compose-plugin

#### Docker Compose
- **–í–µ—Ä—Å–∏—è**: 2.20+
- **–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞**: –≤–µ—Ä—Å–∏—è 3.8

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞**:
```bash
# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
sudo apt remove docker docker-engine docker.io containerd runc

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
sudo apt update
sudo apt install -y ca-certificates curl gnupg lsb-release

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ GPG –∫–ª—é—á–∞ Docker
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
  sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin

# –ü—Ä–æ–≤–µ—Ä–∫–∞
docker --version
docker compose version
```

### 2.4 PostgreSQL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–û–±—Ä–∞–∑**: `postgres:15-alpine`

#### –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è production:

```ini
# –ü–∞–º—è—Ç—å
shared_buffers = 1GB              # 25% –æ—Ç RAM
effective_cache_size = 3GB        # 75% –æ—Ç RAM
work_mem = 16MB                   # RAM / (max_connections * 2)
maintenance_work_mem = 256MB

# Checkpoint
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100

# Query –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
random_page_cost = 1.1
effective_io_concurrency = 200

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
log_min_duration_statement = 1000  # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã > 1s
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è
max_connections = 100
```

### 2.5 Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–û–±—Ä–∞–∑**: `redis:7-alpine`

#### –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
# Persistence
appendonly yes              # –í–∫–ª—é—á–∏—Ç—å AOF
appendfsync everysec       # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
save 900 1                 # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ 1 –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞ 15 –º–∏–Ω
save 300 10                # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ 10 –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∑–∞ 5 –º–∏–Ω
save 60 10000              # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ 10000 –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞ 1 –º–∏–Ω

# –ü–∞–º—è—Ç—å
maxmemory 768mb            # –ú–∞–∫—Å–∏–º—É–º –ø–∞–º—è—Ç–∏
maxmemory-policy allkeys-lru  # –ü–æ–ª–∏—Ç–∏–∫–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
requirepass <strong_password>  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
tcp-backlog 511
timeout 0
tcp-keepalive 300
```

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 3.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ .env —Ñ–∞–π–ª–∞

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
nano .env
```

### 3.2 –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

#### ü§ñ Telegram Bot
```bash
# –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
# –ü–æ–ª—É—á–∏—Ç—å ID: @userinfobot
ADMIN_IDS=123456789,987654321
```

#### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
```bash
# –•–æ—Å—Ç (–≤ Docker –≤—Å–µ–≥–¥–∞ postgres)
POSTGRES_HOST=postgres

# –ü–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
POSTGRES_PORT=5432

# –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
POSTGRES_DB=2getpro_v2_db

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
POSTGRES_USER=2getpro_user

# –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –°–ò–õ–¨–ù–´–ô –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 16 —Å–∏–º–≤–æ–ª–æ–≤)
# –ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: openssl rand -base64 24
POSTGRES_PASSWORD=your_very_strong_password_here_change_me
```

#### üî¥ Redis Cache
```bash
# –•–æ—Å—Ç (–≤ Docker –≤—Å–µ–≥–¥–∞ redis)
REDIS_HOST=redis

# –ü–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
REDIS_PORT=6379

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (0-15)
REDIS_DB=0

# –ü–∞—Ä–æ–ª—å Redis (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)
REDIS_PASSWORD=your_redis_password_here

# –í–∫–ª—é—á–µ–Ω –ª–∏ Redis
REDIS_ENABLED=true

# TTL –¥–ª—è –∫—ç—à–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
REDIS_TTL=3600
```

#### üéõÔ∏è VPN Panel API
```bash
# URL API –ø–∞–Ω–µ–ª–∏ (3x-ui, Marzban, –∏ —Ç.–¥.)
PANEL_API_URL=https://your-panel.example.com/api

# API –∫–ª—é—á –ø–∞–Ω–µ–ª–∏
PANEL_API_KEY=your_panel_api_key_here

# –õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ì–ë, 0 = –±–µ–∑–ª–∏–º–∏—Ç)
USER_TRAFFIC_LIMIT_GB=0.0

# –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–±—Ä–æ—Å–∞ —Ç—Ä–∞—Ñ–∏–∫–∞: NO_RESET, MONTHLY, WEEKLY
USER_TRAFFIC_STRATEGY=NO_RESET

# UUID –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö squad–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
USER_SQUAD_UUIDS=uuid1,uuid2,uuid3

# UUID –≤–Ω–µ—à–Ω–µ–≥–æ squad (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
USER_EXTERNAL_SQUAD_UUID=external-squad-uuid

# –°–µ–∫—Ä–µ—Ç –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ webhook –æ—Ç –ø–∞–Ω–µ–ª–∏
PANEL_WEBHOOK_SECRET=your_webhook_secret_here
```

### 3.3 –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

#### üí≥ YooKassa (–æ—Å–Ω–æ–≤–Ω–∞—è)
```bash
# –í–∫–ª—é—á–∏—Ç—å YooKassa
YOOKASSA_ENABLED=true

# Shop ID –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
YOOKASSA_SHOP_ID=123456

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
YOOKASSA_SECRET_KEY=live_–≤–∞—à_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á

# URL –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
YOOKASSA_RETURN_URL=https://t.me/your_bot

# Email –¥–ª—è —á–µ–∫–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
YOOKASSA_DEFAULT_RECEIPT_EMAIL=

# –ù–î–° –∫–æ–¥ (1 = –±–µ–∑ –ù–î–°)
YOOKASSA_VAT_CODE=1

# –†–µ–∂–∏–º –æ–ø–ª–∞—Ç—ã (full_prepayment, service)
YOOKASSA_PAYMENT_MODE=full_prepayment

# –ü—Ä–µ–¥–º–µ—Ç —Ä–∞—Å—á–µ—Ç–∞ (payment, service, full_payment)
YOOKASSA_PAYMENT_SUBJECT=service

# –ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∏ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç)
YOOKASSA_AUTOPAYMENTS_ENABLED=false

# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∞—Ö
YOOKASSA_AUTOPAYMENTS_REQUIRE_CARD_BINDING=true
```

#### ü™ô CryptoPay (–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞)
```bash
# –í–∫–ª—é—á–∏—Ç—å CryptoPay
CRYPTOPAY_ENABLED=true

# API —Ç–æ–∫–µ–Ω –æ—Ç @CryptoBot
CRYPTOPAY_TOKEN=your_cryptopay_token_here

# –°–µ—Ç—å: mainnet –∏–ª–∏ testnet
CRYPTOPAY_NETWORK=mainnet

# –¢–∏–ø –≤–∞–ª—é—Ç—ã: crypto –∏–ª–∏ fiat
CRYPTOPAY_CURRENCY_TYPE=fiat

# –ê–∫—Ç–∏–≤: RUB, USD, USDT, TON –∏ —Ç.–¥.
CRYPTOPAY_ASSET=RUB
```

#### ‚≠ê Telegram Stars
```bash
# –í–∫–ª—é—á–∏—Ç—å Telegram Stars
STARS_ENABLED=true

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è - –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ Telegram
```

#### üí∞ FreeKassa (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –í–∫–ª—é—á–∏—Ç—å FreeKassa
FREEKASSA_ENABLED=false

# Merchant ID
FREEKASSA_MERCHANT_ID=your_merchant_id

# –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
FREEKASSA_FIRST_SECRET=your_secret_key_1
FREEKASSA_SECOND_SECRET=your_secret_key_2

# API –∫–ª—é—á
FREEKASSA_API_KEY=your_api_key

# URL –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Ñ–æ—Ä–º—ã
FREEKASSA_PAYMENT_URL=https://pay.freekassa.ru/

# IP –¥–ª—è webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
FREEKASSA_PAYMENT_IP=

# ID –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
FREEKASSA_PAYMENT_METHOD_ID=
```

#### üéÅ Tribute (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –í–∫–ª—é—á–∏—Ç—å Tribute
TRIBUTE_ENABLED=true

# API –∫–ª—é—á
TRIBUTE_API_KEY=your_tribute_api_key_here

# –°—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
TRIBUTE_LINK_1_MONTH=https://tribute.to/your_link_1m
TRIBUTE_LINK_3_MONTHS=https://tribute.to/your_link_3m
TRIBUTE_LINK_6_MONTHS=https://tribute.to/your_link_6m
TRIBUTE_LINK_12_MONTHS=https://tribute.to/your_link_12m

# –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏
TRIBUTE_SKIP_NOTIFICATIONS=true

# –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Ç–º–µ–Ω–µ
TRIBUTE_SKIP_CANCELLATION_NOTIFICATIONS=false
```

### 3.4 –¶–µ–Ω—ã –ø–æ–¥–ø–∏—Å–æ–∫

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤
1_MONTH_ENABLED=true
3_MONTHS_ENABLED=true
6_MONTHS_ENABLED=true
12_MONTHS_ENABLED=true

# –¶–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö (–≤ –∫–æ–ø–µ–π–∫–∞—Ö: 1 —Ä—É–± = 100)
RUB_PRICE_1_MONTH=15000     # 150 —Ä—É–±–ª–µ–π
RUB_PRICE_3_MONTHS=40000    # 400 —Ä—É–±–ª–µ–π
RUB_PRICE_6_MONTHS=75000    # 750 —Ä—É–±–ª–µ–π
RUB_PRICE_12_MONTHS=140000  # 1400 —Ä—É–±–ª–µ–π

# –¶–µ–Ω—ã –≤ Telegram Stars
STARS_PRICE_1_MONTH=150
STARS_PRICE_3_MONTHS=400
STARS_PRICE_6_MONTHS=750
STARS_PRICE_12_MONTHS=1400
```

### 3.5 –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

```bash
# –ë–æ–Ω—É—Å—ã –¥–ª—è –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–≥–æ (–≤ –¥–Ω—è—Ö)
REFERRAL_BONUS_DAYS_1_MONTH=3
REFERRAL_BONUS_DAYS_3_MONTHS=7
REFERRAL_BONUS_DAYS_6_MONTHS=15
REFERRAL_BONUS_DAYS_12_MONTHS=30

# –ë–æ–Ω—É—Å—ã –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ (–≤ –¥–Ω—è—Ö)
REFEREE_BONUS_DAYS_1_MONTH=1
REFEREE_BONUS_DAYS_3_MONTHS=3
REFEREE_BONUS_DAYS_6_MONTHS=7
REFEREE_BONUS_DAYS_12_MONTHS=15

# –í—ã–¥–∞–≤–∞—Ç—å –±–æ–Ω—É—Å —Ç–æ–ª—å–∫–æ –∑–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É
REFERRAL_ONE_BONUS_PER_REFEREE=true

# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ legacy —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
LEGACY_REFS=true
```

### 3.6 –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥

```bash
# –í–∫–ª—é—á–∏—Ç—å —Ç—Ä–∏–∞–ª
TRIAL_ENABLED=true

# –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–Ω–µ–π)
TRIAL_DURATION_DAYS=3

# –õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ (–ì–ë)
TRIAL_TRAFFIC_LIMIT_GB=5.0
```

### 3.7 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```bash
# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö
SUBSCRIPTION_NOTIFICATIONS_ENABLED=true
SUBSCRIPTION_NOTIFY_ON_EXPIRE=true
SUBSCRIPTION_NOTIFY_AFTER_EXPIRE=true
SUBSCRIPTION_NOTIFY_DAYS_BEFORE=3

# ID —á–∞—Ç–∞ –¥–ª—è –ª–æ–≥–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
LOG_CHAT_ID=
LOG_THREAD_ID=

# –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
LOG_NEW_USERS=true
LOG_PAYMENTS=true
LOG_PROMO_ACTIVATIONS=true
LOG_TRIAL_ACTIVATIONS=true
LOG_SUSPICIOUS_ACTIVITY=true
```

### 3.8 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```bash
# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=30
RATE_LIMIT_WINDOW=60

# –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ–±-—Ö—É–∫–æ–≤
WEBHOOK_VALIDATION_ENABLED=true

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è webhook (—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ: openssl rand -hex 32)
WEBHOOK_SECRET_TOKEN=your_generated_secret_token_here
```

### 3.9 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

#### Sentry (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫)
```bash
# –í–∫–ª—é—á–∏—Ç—å Sentry
SENTRY_ENABLED=false

# DSN –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ Sentry
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# –û–∫—Ä—É–∂–µ–Ω–∏–µ
SENTRY_ENVIRONMENT=production

# –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (0.0 - 1.0)
SENTRY_TRACES_SAMPLE_RATE=0.1
```

#### Prometheus (–º–µ—Ç—Ä–∏–∫–∏)
```bash
# –í–∫–ª—é—á–∏—Ç—å Prometheus
PROMETHEUS_ENABLED=true

# –ü–æ—Ä—Ç –¥–ª—è –º–µ—Ç—Ä–∏–∫
PROMETHEUS_PORT=9090

# –ü—É—Ç—å –∫ –º–µ—Ç—Ä–∏–∫–∞–º
PROMETHEUS_METRICS_PATH=/metrics
```

#### Grafana (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
```bash
# –ü–∞—Ä–æ–ª—å –¥–ª—è Grafana (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é admin/admin)
GRAFANA_PASSWORD=your_secure_grafana_password
```

### 3.10 –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ webhook

```bash
# –•–æ—Å—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
WEB_SERVER_HOST=0.0.0.0

# –ü–æ—Ä—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
WEB_SERVER_PORT=8080

# –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è webhook (—Å HTTPS!)
WEBHOOK_BASE_URL=https://your-domain.com

# –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–æ–≤
LOGS_PAGE_SIZE=10
```

### 3.11 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (ru –∏–ª–∏ en)
DEFAULT_LANGUAGE=ru

# –í–∞–ª—é—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_CURRENCY_SYMBOL=RUB

# –ü–æ–¥–¥–µ—Ä–∂–∫–∞
SUPPORT_LINK=https://t.me/your_support

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–æ–≤
SERVER_STATUS_URL=https://status.example.com

# –£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
TERMS_OF_SERVICE_URL=https://example.com/terms

# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª (ID –∏ —Å—Å—ã–ª–∫–∞)
REQUIRED_CHANNEL_ID=-1001234567890
REQUIRED_CHANNEL_LINK=https://t.me/your_channel

# URL –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫
SUBSCRIPTION_MINI_APP_URL=

# –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã /start
START_COMMAND_DESCRIPTION=

# –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
DISABLE_WELCOME_MESSAGE=false

# –í–∫–ª—é—á–∏—Ç—å —Å–µ–∫—Ü–∏—é "–ú–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"
MY_DEVICES_SECTION_ENABLED=false

# –õ–∏–º–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (0 = –±–µ–∑–ª–∏–º–∏—Ç)
USER_HWID_DEVICE_LIMIT=

# URL –º–∏–Ω–∏–∞—Ç—é—Ä –¥–ª—è inline —Ä–µ–∂–∏–º–∞
INLINE_REFERRAL_THUMBNAIL_URL=https://cdn-icons-png.flaticon.com/512/1077/1077114.png
INLINE_USER_STATS_THUMBNAIL_URL=https://cdn-icons-png.flaticon.com/512/681/681494.png
INLINE_FINANCIAL_STATS_THUMBNAIL_URL=https://cdn-icons-png.flaticon.com/512/2769/2769339.png
INLINE_SYSTEM_STATS_THUMBNAIL_URL=https://cdn-icons-png.flaticon.com/512/2920/2920277.png
```

---

## 4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Docker Compose

### 4.1 –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (docker-compose.yml)

–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª [`docker-compose.yml`](docker-compose.yml) —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

### 4.2 Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ [`infrastructure/docker/docker-compose.prod.yml`](infrastructure/docker/docker-compose.prod.yml:1).

#### –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è production:

1. **–ù–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –±–æ—Ç–∞** (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å)
2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤** (CPU/Memory limits)
3. **Health checks** –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Prometheus + Grafana + exporters)
5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
6. **Nginx** –∫–∞–∫ reverse proxy

### 4.3 –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

–°–æ–∑–¥–∞–π—Ç–µ `docker-compose.override.yml` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

```yaml
version: '3.8'

services:
  # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞
  bot:
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: '1'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 1G
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
  
  # PostgreSQL exporter –¥–ª—è –º–µ—Ç—Ä–∏–∫
  postgres-exporter:
    image: prometheuscommunity/postgres-exporter:latest
    container_name: 2getpro_postgres_exporter
    environment:
      DATA_SOURCE_NAME: "postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}?sslmode=disable"
    networks:
      - bot_network
    depends_on:
      - postgres
  
  # Redis exporter –¥–ª—è –º–µ—Ç—Ä–∏–∫
  redis-exporter:
    image: oliver006/redis_exporter:latest
    container_name: 2getpro_redis_exporter
    environment:
      REDIS_ADDR: "redis:6379"
      REDIS_PASSWORD: ${REDIS_PASSWORD}
    networks:
      - bot_network
    depends_on:
      - redis

networks:
  bot_network:
    driver: bridge
```

---

## 5. –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### 5.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Ubuntu 24.04

#### –®–∞–≥ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@your-server-ip

# –û–±–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç—ã
sudo apt update && sudo apt upgrade -y

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
sudo reboot
```

#### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö —É—Ç–∏–ª–∏—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
sudo apt install -y \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    lsb-release \
    software-properties-common \
    git \
    wget \
    nano \
    htop \
    net-tools
```

#### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ UFW
sudo apt install -y ufw

# –†–∞–∑—Ä–µ—à–∏—Ç–µ SSH
sudo ufw allow 22/tcp

# –†–∞–∑—Ä–µ—à–∏—Ç–µ HTTP –∏ HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# –í–∫–ª—é—á–∏—Ç–µ firewall
sudo ufw --force enable

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo ufw status
```

### 5.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
# –°–∫–∞—á–∞–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç Docker
curl -fsSL https://get.docker.com -o get-docker.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
sudo sh get-docker.sh

# –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
newgrp docker

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
docker --version
docker compose version
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
Docker version 24.0.7, build afdd53b
Docker Compose version v2.23.0
```

### 5.3 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

#### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /opt

# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
git clone https://github.com/your-username/2GETPRO-v2.git
cd 2GETPRO-v2

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
ls -la
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä
cp .env.example .env

# –û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
nano .env
```

**–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 3!

#### –®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π
openssl rand -base64 32  # –î–ª—è POSTGRES_PASSWORD
openssl rand -base64 32  # –î–ª—è REDIS_PASSWORD
openssl rand -hex 32     # –î–ª—è WEBHOOK_SECRET_TOKEN
openssl rand -base64 24  # –î–ª—è GRAFANA_PASSWORD
```

–í—Å—Ç–∞–≤—å—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `.env`.

#### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å docker-compose.yml
docker compose config

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑ –æ—à–∏–±–æ–∫
```

### 5.4 –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

#### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∏ –∏ volumes

```bash
# Docker Compose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –∏—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
# –ù–æ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è

docker network create bot_network
docker volume create postgres_data
docker volume create redis_data
docker volume create prometheus_data
docker volume create grafana_data
```

#### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
NAME                      STATUS          PORTS
2getpro_v2_bot            running         
2getpro_v2_postgres       running (healthy)   5432/tcp
2getpro_v2_redis          running (healthy)   6379/tcp
2getpro_v2_prometheus     running         9090/tcp
2getpro_v2_grafana        running         3000/tcp
```

#### –®–∞–≥ 3: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose logs -f

# –¢–æ–ª—å–∫–æ –±–æ—Ç
docker compose logs -f bot

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker compose logs --tail=100 bot
```

### 5.5 –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞
docker compose exec bot bash

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python db/migrator.py

# –í—ã–π–¥–∏—Ç–µ
exit
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
docker compose exec postgres psql -U 2getpro_user -d 2getpro_v2_db

# –í—ã–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
\dt

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# - users
# - subscriptions
# - payments
# - promo_codes
# - transactions
# –∏ –¥—Ä—É–≥–∏–µ

# –í—ã–π–¥–∏—Ç–µ
\q
```

### 5.6 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

#### Health checks

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoints
curl http://localhost:8080/health

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: {"status": "ok"}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus
curl http://localhost:9090/-/healthy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Grafana
curl http://localhost:3000/api/health
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ—Ç–∞ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –ø–æ username
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
4. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

### 5.7 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è webhook)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook –≤–º–µ—Å—Ç–æ polling:

#### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx

```bash
sudo apt install -y nginx certbot python3-certbot-nginx
```

#### –®–∞–≥ 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

```bash
sudo nano /etc/nginx/sites-available/bot
```

–î–æ–±–∞–≤—å—Ç–µ:

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }
    
    location / {
        return 301 https://$host$request_uri;
    }
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;
    
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
```

#### –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo ln -s /etc/nginx/sites-available/bot /etc/nginx/sites-enabled/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx
sudo systemctl restart nginx

# –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx -d your-domain.com

# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
```

#### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç–µ .env

```bash
nano .env
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```bash
WEBHOOK_BASE_URL=https://your-domain.com
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
docker compose restart bot
```

---

## 6. –ß–µ–∫-–ª–∏—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### 6.1 –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞

- [ ] **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: `/start` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ö–æ–º–∞–Ω–¥–∞ "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- [ ] **–Ø–∑—ã–∫–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º/–∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- [ ] **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
- [ ] **Inline —Ä–µ–∂–∏–º**: –†–∞–±–æ—Ç–∞ inline –∫–æ–º–∞–Ω–¥ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

### 6.2 –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

#### YooKassa
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ YooKassa
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- [ ] Webhook –æ—Ç YooKassa –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- [ ] –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
- [ ] –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

#### CryptoPay
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ CryptoPay
- [ ] Webhook –æ—Ç CryptoPay –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- [ ] –û–ø–ª–∞—Ç–∞ –≤ USDT —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û–ø–ª–∞—Ç–∞ –≤ TON —Ä–∞–±–æ—Ç–∞–µ—Ç

#### Telegram Stars
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞ —Å–æ Stars
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã Stars
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

#### FreeKassa (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- [ ] Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏

#### Tribute (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
- [ ] –°—Å—ã–ª–∫–∏ –Ω–∞ Tribute —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

### 6.3 –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- [ ] **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –ö–æ–º–∞–Ω–¥–∞ /stats –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- [ ] **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**: –ü—Ä–æ—Å–º–æ—Ç—Ä, –±–∞–Ω, —Ä–∞–∑–±–∞–Ω
- [ ] **–ü–ª–∞—Ç–µ–∂–∏**: –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ø–∞–Ω–µ–ª—å—é**: –ö–æ–º–∞–Ω–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] **–†–∞—Å—Å—ã–ª–∫–∞**: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- [ ] **–õ–æ–≥–∏**: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π
- [ ] **–†–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

### 6.4 –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –£—á–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏–≥–ª–∞—à–∞—é—â–µ–º—É
- [ ] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–º—É
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- [ ] –û–¥–∏–Ω –±–æ–Ω—É—Å –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

### 6.5 –ü—Ä–æ–º–æ–∫–æ–¥—ã

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- [ ] –û–¥–∏–Ω–æ—á–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥
- [ ] –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- [ ] –õ–∏–º–∏—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
- [ ] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–Ω–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- [ ] –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É

### 6.6 –ü–æ–¥–ø–∏—Å–∫–∏

#### –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- [ ] –ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è
- [ ] –†–∞—Å—á–µ—Ç –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –¥–Ω–µ–π

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞–Ω–µ–ª—å—é
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–∞–Ω–µ–ª–∏
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –ø–∞–Ω–µ–ª–∏
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

#### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –ó–∞ 3 –¥–Ω—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –í –¥–µ–Ω—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

### 6.7 –¢–µ—Å—Ç–æ–≤—ã–π –∏ Production —Ä–µ–∂–∏–º—ã

#### –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–∞–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –õ–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —Ç—Ä–∏–∞–ª–∞
- [ ] –û–¥–∏–Ω —Ç—Ä–∏–∞–ª –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ –æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç—Ä–∏–∞–ª–∞

#### Production —Ä–µ–∂–∏–º
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Production –ø–ª–∞—Ç–µ–∂–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Webhook –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞
- [ ] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ Sentry (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

### 6.8 –°–∏—Å—Ç–µ–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤

- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç–µ–∂–∏
- [ ] –û–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –±–∞–ª–∞–Ω—Å–∞
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å

---

## 7. Troubleshooting

### 7.1 –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

#### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs --tail=100 bot

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è:**

1. **–ù–µ–≤–µ—Ä–Ω—ã–π BOT_TOKEN**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω
grep BOT_TOKEN .env

# –û–±–Ω–æ–≤–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
nano .env
docker compose restart bot
```

2. **–ù–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
docker compose ps postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
docker compose exec postgres pg_isready -U 2getpro_user

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PostgreSQL
docker compose logs postgres
```

3. **–û—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏**
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
docker compose exec bot python db/migrator.py
```

### 7.2 –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

#### –ü—Ä–æ–±–ª–µ–º–∞: "too many connections"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í–æ–π–¥–∏—Ç–µ –≤ PostgreSQL
docker compose exec postgres psql -U 2getpro_user -d 2getpro_v2_db

# –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
ALTER SYSTEM SET max_connections = 200;

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
\q
docker compose restart postgres
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î
docker compose exec postgres psql -U 2getpro_user -d 2getpro_v2_db

-- –ù–∞–π–¥–∏—Ç–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
SELECT pid, now() - query_start as duration, query 
FROM pg_stat_activity 
WHERE state = 'active' 
AND now() - query_start > interval '1 second';
```

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)
CREATE INDEX CONCURRENTLY idx_payments_user_id ON payments(user_id);
CREATE INDEX CONCURRENTLY idx_subscriptions_end_date ON subscriptions(end_date);
CREATE INDEX CONCURRENTLY idx_users_panel_uuid ON users(panel_user_uuid);

-- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
VACUUM ANALYZE;
```

### 7.3 –ü—Ä–æ–±–ª–µ–º—ã —Å Redis

#### –ü—Ä–æ–±–ª–µ–º–∞: Redis connection timeout

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps redis

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
docker compose exec redis redis-cli ping
```

**–° –ø–∞—Ä–æ–ª–µ–º:**
```bash
docker compose exec redis redis-cli -a your_redis_password ping
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Redis
docker compose restart redis

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–º—è—Ç—å
docker compose exec redis redis-cli INFO memory
```

### 7.4 –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏

#### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint
curl -I https://your-domain.com/webhook/yookassa

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)
sudo tail -f /var/log/nginx/error.log

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
docker compose logs --tail=100 bot | grep webhook
```

**–†–µ—à–µ–Ω–∏–µ:**

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall**
```bash
sudo ufw status
sudo ufw allow 443/tcp
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç**
```bash
sudo certbot certificates
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook URL –≤ .env**
```bash
grep WEBHOOK_BASE_URL .env
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: https://your-domain.com (—Å HTTPS!)
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å webhook

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
grep SECRET .env

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∏–∑ –ª–∏—á–Ω—ã—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
docker compose restart bot
```

### 7.5 –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

#### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø–∞–º—è—Ç–∏
docker stats --no-stream --format "table {{.Name}}\t{{.MemUsage}}" | sort -k 2 -h
```

**–†–µ—à–µ–Ω–∏–µ:**

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–∏–º–∏—Ç—ã –≤ `docker-compose.override.yml`:
```yaml
services:
  bot:
    deploy:
      resources:
        limits:
          memory: 2G
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ –±–æ—Ç–∞

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:9090/api/v1/query?query=bot_response_time_seconds

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
docker compose logs bot | grep -i "slow"
```

**–†–µ—à–µ–Ω–∏–µ:**

1. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î** (–¥–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã)
2. **–£–≤–µ–ª–∏—á—å—Ç–µ TTL –∫—ç—à–∞ Redis**
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ** (–¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –±–æ—Ç–∞)

### 7.6 –ü—Ä–æ–±–ª–µ–º—ã —Å Docker

#### –ü—Ä–æ–±–ª–µ–º–∞: "No space left on device"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -a

# –û—á–∏—Å—Ç–∏—Ç–µ volumes
docker volume prune

# –û—á–∏—Å—Ç–∏—Ç–µ –≤—Å—ë
docker system prune -a --volumes
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ç—å
docker compose down
docker network prune
docker compose up -d
```

### 7.7 –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç

–°–æ–∑–¥–∞–π—Ç–µ `diagnose.sh`:

```bash
#!/bin/bash
echo "=== Docker Version ==="
docker --version
docker compose version

echo -e "\n=== Container Status ==="
docker compose ps

echo -e "\n=== Recent Logs (Bot) ==="
docker compose logs --tail=50 bot

echo -e "\n=== Database Status ==="
docker compose exec postgres pg_isready -U 2getpro_user || echo "PostgreSQL not ready"

echo -e "\n=== Redis Status ==="
docker compose exec redis redis-cli ping || echo "Redis not ready"

echo -e "\n=== Disk Usage ==="
df -h

echo -e "\n=== Memory Usage ==="
free -h

echo -e "\n=== Docker Stats ==="
docker stats --no-stream
```

–ó–∞–ø—É—Å–∫:
```bash
chmod +x diagnose.sh
./diagnose.sh > diagnostic_report.txt
```

---

## 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### 8.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Prometheus

Prometheus —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ [`infrastructure/prometheus/prometheus.yml`](infrastructure/prometheus/prometheus.yml:1).

**–î–æ—Å—Ç—É–ø:** `http://your-server-ip:9090`

#### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (PromQL):

```promql
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
count(users{is_active="true"})

# RPS (–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É)
rate(bot_requests_total[5m])

# –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—Ç–∞
avg(bot_response_time_seconds)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
container_memory_usage_bytes{name="2getpro_v2_bot"}

# CPU usage
rate(container_cpu_usage_seconds_total{name="2getpro_v2_bot"}[5m])
```

### 8.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

**–î–æ—Å—Ç—É–ø:** `http://your-server-ip:3000`  
**–õ–æ–≥–∏–Ω:** admin  
**–ü–∞—Ä–æ–ª—å:** –ò–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `GRAFANA_PASSWORD` –≤ .env

#### –ò–º–ø–æ—Ä—Ç –¥–∞—à–±–æ—Ä–¥–æ–≤:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana
2. **Dashboards ‚Üí Import**
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ID –¥–∞—à–±–æ—Ä–¥–∞:
   - **Docker Container Metrics**: `193`
   - **PostgreSQL Database**: `9628`
   - **Redis Dashboard**: `11835`
   - **Nginx**: `12708`

#### –°–æ–∑–¥–∞–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤:

1. **Alerts ‚Üí Alert rules ‚Üí New alert rule**
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—Å–ª–æ–≤–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:
   - –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç > 5 –º–∏–Ω—É—Ç
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ > 90%
   - –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ < 10%

### 8.3 –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `backup.sh`:

```bash
#!/bin/bash
set -e

BACKUP_DIR="/var/backups/2getpro"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=7

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p "$BACKUP_DIR"

# –ë—ç–∫–∞–ø PostgreSQL
echo "Backing up PostgreSQL..."
docker compose exec -T postgres pg_dump -U 2getpro_user 2getpro_v2_db | \
    gzip > "$BACKUP_DIR/db_$DATE.sql.gz"

# –ë—ç–∫–∞–ø Redis
echo "Backing up Redis..."
docker compose exec redis redis-cli SAVE
docker cp 2getpro_v2_redis:/data/dump.rdb "$BACKUP_DIR/redis_$DATE.rdb"

# –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "Backing up configuration..."
tar -czf "$BACKUP_DIR/config_$DATE.tar.gz" .env docker-compose.yml

# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã
echo "Cleaning old backups..."
find "$BACKUP_DIR" -name "db_*.sql.gz" -mtime +$RETENTION_DAYS -delete
find "$BACKUP_DIR" -name "redis_*.rdb" -mtime +$RETENTION_DAYS -delete
find "$BACKUP_DIR" -name "config_*.tar.gz" -mtime +$RETENTION_DAYS -delete

echo "Backup completed: $DATE"
```

#### –î–æ–±–∞–≤—å—Ç–µ –≤ cron:

```bash
chmod +x backup.sh

# –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00 AM
crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
```cron
0 3 * * * cd /opt/2GETPRO-v2 && ./backup.sh >> /var/log/2getpro_backup.log 2>&1
```

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞:

```bash
# PostgreSQL
gunzip < /var/backups/2getpro/db_20240101_030000.sql.gz | \
    docker compose exec -T postgres psql -U 2getpro_user 2getpro_v2_db

# Redis
docker cp /var/backups/2getpro/redis_20240101_030000.rdb 2getpro_v2_redis:/data/dump.rdb
docker compose restart redis
```

### 8.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞
docker compose down

# –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥
git pull origin main

# –û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
docker compose build --no-cache

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
docker compose run --rm bot python db/migrator.py

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs -f bot
```

### 8.5 –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose restart bot

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose exec bot bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
docker compose exec bot sh -c "rm -rf logs/*.log"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
docker compose ps
curl http://localhost:8080/health

# –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
curl http://localhost:9090/metrics

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ë–î
docker compose exec -T postgres pg_dump -U 2getpro_user 2getpro_v2_db > backup.sql
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

- [README](README.md) - –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
- [INSTALLATION_GUIDE](docs/deployment/INSTALLATION_GUIDE.md) - –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- [Docker Guide](docs/deployment/docker.md) - Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- [Production Checklist](docs/deployment/production.md) - –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- [Troubleshooting](docs/operations/troubleshooting.md) - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- [API Documentation](docs/api/README.md) - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Docker Documentation](https://docs.docker.com/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Redis Documentation](https://redis.io/documentation)
- [aiogram Documentation](https://docs.aiogram.dev/)
- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/)

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**: `docker compose logs -f bot`
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É**: `./diagnose.sh`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `docs/`
4. **–°–æ–∑–¥–∞–π—Ç–µ Issue** –Ω–∞ GitHub —Å:
   - –û–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã
   - –®–∞–≥–∞–º–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
   - –õ–æ–≥–∞–º–∏
   - –í–µ—Ä—Å–∏–µ–π —Å–∏—Å—Ç–µ–º—ã

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –°–ò–õ–¨–ù–´–ï –ø–∞—Ä–æ–ª–∏ (PostgreSQL, Redis, Grafana)
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–¥–ª—è webhook)
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç (Prometheus + Grafana)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] Webhook –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞
- [ ] Rate limiting –≤–∫–ª—é—á–µ–Ω
- [ ] Health checks —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-11-28  
**–ê–≤—Ç–æ—Ä**: 2GETPRO Team  
**–õ–∏—Ü–µ–Ω–∑–∏—è**: MIT

üöÄ **–£–¥–∞—á–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è!**